#!/bin/bash

# Cleanup (required by evaluation)
docker stop $(docker ps -qa); docker rm $(docker ps -qa); docker rmi -f $(docker images -qa); docker volume rm $(docker volume ls -q); docker network rm $(docker network ls -q) 2>/dev/null

# Start everything
make

# Check containers
docker-compose -f srcs/docker-compose.yml ps

# Check networks
docker network ls

# Check volumes
docker volume ls

# Test HTTPS works
curl -k https://abouguri.42.fr

# Test HTTP blocked
curl http://abouguri.42.fr

# Check SSL certificate
openssl s_client -connect abouguri.42.fr:443 </dev/null 2>/dev/null | openssl x509 -text | head -20

# Login to database
docker exec abouguri_mariadb mysql -u root -prootpassword123

# Show databases
docker exec abouguri_mariadb mysql -u root -prootpassword123 -e "SHOW DATABASES;"

# Show WordPress tables
docker exec abouguri_mariadb mysql -u root -prootpassword123 -e "USE wordpress; SHOW TABLES;"

# Check WordPress volume
docker volume inspect srcs_wordpress_data

# Check MariaDB volume
docker volume inspect srcs_mariadb_data

WordPress Admin:
- Username: abouguri
- Password: admin123
- Email: admin@abouguri.42.fr

Regular User:
- Username: user  
- Password: user123
- Email: user@abouguri.42.fr

Database Root:
- Username: root
- Password: rootpassword123

# Stop containers
make down

# Clean everything
make clean

# Restart from scratch
make re

# Show .env (credentials)
cat srcs/.env

# Show Dockerfiles
ls srcs/requirements/*/Dockerfile

# Show docker-compose
cat srcs/docker-compose.yml